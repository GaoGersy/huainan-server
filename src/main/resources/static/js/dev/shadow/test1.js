require(["../../requireconfig"],function(){require(["air","zepto","vue","vue-resource","layer","global","LArea","LAreaData1","LAreaData2"],function(e,t,o,n,a,i,l,s,r){({init:function(){var e=this;o.use(n),e.index=new o({el:"#app",data:{localsearch:"",map:"",zoom:12,marker:"",infoWin:"",bounds:"",config:{},areaStatus:"",isArea:!1,code:""},methods:{onLoad:function(){var e=this;e.map=new T.Map("mapDiv"),e.map.centerAndZoom(new T.LngLat(113.25723,23.12842),e.zoom),setTimeout(function(){$(".loading").hide()},500),e.config={pageCapacity:10,onSearchComplete:e.localSearchResult},e.localsearch=new T.LocalSearch(e.map,e.config)},search:function(){var e=this;console.log("search"),console.log(document.getElementById("keyWord").value),e.localsearch.search(document.getElementById("keyWord").value,7)},localSearchResult:function(e){var t=this;switch(t.clearAll(),t.prompt(e),parseInt(e.getResultType())){case 1:t.pois(e.getPois());break;case 2:t.statistics(e.getStatistics());break;case 3:t.area(e.getArea())}},prompt:function(e){var t=e.getPrompt();if(t){for(var o="",n=0;n<t.length;n++){var a=t[n],i=a.type,l=a.admins,s=a.DidYouMean;if(1==i);else if(2==i)o+="<p>在<strong>"+l[0].name+"</strong>没有搜索到与<strong>"+e.getKeyword()+"</strong>相关的结果。<p>",s&&(o+="<p>您是否要找：<font weight='bold' color='#035fbe'><strong>"+s+"</strong></font><p>");else if(3==i)for(o+="<p style='margin-bottom:3px;'>有以下相关结果，您是否要找：</p>",n=0;n<l.length;n++)o+="<p>"+l[n].name+"</p>"}""!=o&&(document.getElementById("promptDiv").style.display="block",document.getElementById("promptDiv").innerHTML=o)}},pois:function(e){var t=this;if(e){for(var o=document.createElement("div"),n=[],a=0;a<e.length;a++)!function(a){var i=e[a].name,l=e[a].address,s=e[a].lonlat.split(" "),r=new T.LngLat(s[0],s[1]),c="地址:"+l,d=new T.Marker(r);t.map.addOverLay(d),d.addEventListener("click",function(){t.showPosition(d,i,c)},this),n.push(r);var u=document.createElement("a");u.href="javascript://",u.innerHTML=i,u.onclick=function(){t.showPosition(d,i,c),document.getElementById("resultDiv").style.display="none"},o.appendChild(u)}(a);t.map.setViewport(n),document.getElementById("searchDiv").appendChild(o),document.getElementById("resultDiv").style.display="block"}},showPosition:function(e,t){var o=this;o.infoWin&&(o.map.removeOverLay(o.infoWin),o.infoWin=null);var n="<h5>"+t+"</h5>";o.infoWin=new T.InfoWindow(n,new T.Point([0,0])),e.openInfoWindow(o.infoWin)},statistics:function(e){if(e){var t="",o="",n=e.priorityCitys;if(n){t+="在中国以下城市有结果<ul>";for(i=0;i<n.length;i++)t+="<li>"+n[i].name+"("+n[i].count+")</li>";t+="</ul>"}var a=e.allAdmins;if(a){o+="更多城市<ul>";for(var i=0;i<a.length;i++){o+="<li>"+a[i].name+"("+a[i].count+")";var l=a[i].childAdmins;if(l)for(var s=0;s<l.length;s++)o+="<blockquote>"+l[s].name+"("+l[s].count+")</blockquote>";o+="</li>"}o+="</ul>"}document.getElementById("statisticsDiv").style.display="block",document.getElementById("statisticsDiv").innerHTML=t+o}},area:function(e){var t=this;if(e){for(var o=[],n=e.points,a=0;a<n.length;a++){for(var i=[],l=n[a].region.split(","),s=0;s<l.length;s++){var r=l[s].split(" "),c=new T.LngLat(r[0],r[1]);i.push(c),o.push(c)}var d=new T.Polyline(i,{strokeColor:"blue",strokeWeight:3,strokeOpacity:1,strokeStyle:"dashed"});t.map.addOverLay(d)}t.map.setViewport(o)}},clearAll:function(){this.map.clearOverLays(),document.getElementById("searchDiv").innerHTML="",document.getElementById("resultDiv").style.display="none",document.getElementById("statisticsDiv").innerHTML="",document.getElementById("statisticsDiv").style.display="none",document.getElementById("promptDiv").innerHTML="",document.getElementById("promptDiv").style.display="none",document.getElementById("suggestsDiv").innerHTML="",document.getElementById("suggestsDiv").style.display="none",document.getElementById("lineDataDiv").innerHTML="",document.getElementById("lineDataDiv").style.display="none"},getMapBounds:function(){var e=this,t=e.map.getBounds(),o=t.getSouthWest(),n=t.getNorthEast();console.log("改变经纬度11"),console.log(o);var a=o.getLat(),i=n.getLng(),l=n.getLat(),s=n.getLng(),r=n.getLng(),c=o.getLat(),d=o.getLat(),u=o.getLng();e.bounds={topLeftLatitude:a,topLeftLongitude:i,topRightLatitude:l,topRightLongitude:s,bottomRightLatitude:r,bottomRightLongitude:c,bottomLeftLatitude:d,bottomLeftLongitude:u},console.log(e.bounds)},getSide:function(){$(".push").hide(),$(".marking").show(),$("html").addClass("noscroll")},hideSide:function(e){e.stopPropagation(),$(".push").show(),$(".marking").hide(),$("html").removeClass("noscroll")},getArea1:function(e){var t=this;e.stopPropagation(),console.log(e.currentTarget.className),console.log(e.target),$(e.currentTarget).addClass("on").siblings().removeClass("on"),console.log($(e.currentTarget)[0].className),console.log($(e.currentTarget).is(".current-area")),$(e.currentTarget).is(".current-area")?(t.areaStatus=0,t.isArea=!1,t.getMapBounds(),console.log("当前屏幕"),console.log(t.bounds),$("#areaName").html("")):(t.areaStatus=1,t.isArea=!0,$("#demo2").click(),console.log("选择区域"),console.log($("#demo2").val()),console.log($("#value2").val()))},getData:function(){var e=this,t=$(".begin").val(),o=$(".end").val();if(0==e.areaStatus)e.bounds;else $("#value2").val();var n=$("#cloud").val();return null==t||0==t.length?(i.popupMobile.msg("请选择开始日期"),!1):null==o||0==o.length?(i.popupMobile.msg("请选择截止日期"),!1):null==n||0==n.length?(i.popupMobile.msg("请输入云盖量"),!1):void 0},submit:function(e){var t=this;e.stopPropagation();var o=$(".begin").val(),n=$(".end").val();if(0==t.areaStatus){t.isArea=!1;t.bounds}else{t.isArea=!0;var a=$("#value2").val();console.log(a),t.code=a.substring(14,23),console.log(t.code)}var l=$("#cloud").val(),s="",r=!1,c=!1,d=!1,u=!1,g=[],h=[],p=[],m=[],v=$(".tree_node_parent_checkbox:checked");console.log("选择的父级"),console.log(v);for(var f=0;f<v.length;f++){s=$(v[f]).attr("value"),console.log("fatherVal"),console.log(s);var y=$(v[f]).parents(".tree_node_parent1").siblings(".tree_node_child1").find(".tree_node_child_checkbox:checked");console.log("children"),console.log(y);for(var _=0;_<y.length;_++)"gf1"==s?(r=!0,g.push($(y[_]).attr("value"))):"gf2"==s?(c=!0,h.push($(y[_]).attr("value"))):"gf3"==s?(d=!0,p.push($(y[_]).attr("value"))):(u=!0,m.push($(y[_]).attr("value")))}if(null==o||0==o.length)return i.popupMobile.msg("请选择开始日期"),!1;if(null==n||0==n.length)return i.popupMobile.msg("请选择截止日期"),!1;if(null==s||0==s.length)return i.popupMobile.msg("请选择卫星及传感器"),!1;if(null==l||0==l.length)return i.popupMobile.msg("请输入云盖量"),!1;var b=t.bounds;b.cloudPercent=l,b.startTime=o+" 00:00:00",b.endTime=n+" 24:00:00",b.gf1_enable=r,b.gf2_enable=c,b.gf3_enable=d,b.gf4_enable=u,b.sensorIds_1=g,b.sensorIds_2=h,b.currentPage=1,b.pageSize=10,b.isArea=t.isArea,b.code=t.code,console.log(encodeURI(JSON.stringify(b))),window.location.href="./resultList.html?data="+encodeURI(JSON.stringify(b))},isLogin:function(){var e=this,t={OPENID:"asasa11a1ss223412"},o=i.baseUrlfjh+"user/getUserInfo";e.$http.post(o,t).then(function(t){200==t.data.code?(e.userInfo=t.data,0==e.userInfo.statu?(i.popupMobile.msg("您还未登陆"),setTimeout(function(){window.location.href="../login.html"},1e3)):i.popupMobile.msg("登陆成功")):i.popupMobile.msg("登陆失败")},function(){i.popupMobile.msg("登陆失败")})},isShowResult:function(){document.getElementById("resultDiv").style.display="none"}},filters:{formateMoney:function(e){return"￥ "+e.toFiexed(2)}},mounted:function(){var e=this,t=document.body.clientHeight;i.popupMobile.msg("bodyHeight:"+t);var o=$("#app").height();i.popupMobile.msg("divApp:"+o),$(".aside").on("touchmove",function(e){e.preventDefault()});var n=$(".push"),a=$("#aside");n.on("click",function(){a.addClass("active"),$.smartScroll(a,".condition-search"),$("html").addClass("noscroll")}),$(".hideAside").on("click",function(){$("html").removeClass("noscroll"),a.removeClass("active")}),$.smartScroll=function(e,t){if(t&&!e.data("isBindScroll")){var o={posY:0,maxscroll:0};e.on({touchstart:function(e){var n=e.touches[0]||e,a=$(e.target);if(a.length){var i;a.is(t)?i=a:0==(i=a.parents(t)).length&&(i=null),i&&(o.elScroll=i,o.posY=n.pageY,o.scrollY=i.scrollTop(),o.maxscroll=i[0].scrollHeight-i[0].clientHeight)}},touchmove:function(){o.maxscroll<=0&&event.preventDefault();var e=o.elScroll,t=e.scrollTop(),n=(event.touches[0]||event).pageY-o.posY;n>0&&0==t?event.preventDefault():n<0&&t+1>=o.maxscroll&&event.preventDefault()},touchend:function(){o.maxscroll=0}}),e.data("isBindScroll",!0)}},e.onLoad(),e.getMapBounds(),$(".tree_node_child1").hide(),$(".condition-search").on("touchstart",function(t){e.map.disableDrag(),t.stopPropagation()}),$(".condition-search").on("touchmove",function(t){e.map.disableDrag(),t.stopPropagation()}),$(".condition-search").on("touchend",function(t){setTimeout(function(){e.map.enableDrag()},2e3)});var s=localStorage.getItem("token",s);console.log("token"),console.log(s);var r=new Date,c=i.dateFormat(r.getTime(),"yyyy-MM-dd"),d=i.dateFormat(r.getTime()-7776e6,"yyyy-MM-dd");$("#begin").attr("value",d),$("#end").attr("value",c),e.map.addEventListener("zoomend",e.getMapBounds),e.map.addEventListener("moveend",e.getMapBounds);var u=document.getElementById("cloud");u.onkeyup=function(){this.value=this.value.replace(/\D/g,""),u.value>100&&(u.value=100)};var g=new l;g.init({trigger:"#demo1",valueTo:"#value1",keys:{id:"id",name:"name"},type:1,data:LAreaData}),g.value=[1,13,3];var h=new l;h.init({trigger:"#demo2",valueTo:"#value2",keys:{id:"value",name:"text"},type:2,data:[provs_data,citys_data,dists_data]}),h.value=[18,0,4],laydate.skin("molv"),laydate({elem:"#demo"}),laydate({elem:"#test1",format:"YYYY年MM月DD日",festival:!0,choose:function(e){alert("得到："+e)}}),laydate({elem:"#hello3",min:laydate.now(-1),max:laydate.now(1)}),$(function(){$(".tree_node_parent_checkbox").click(function(){var e=$(this).prop("checked"),t=$(this);if(e){var o=$(this).parents(".tree_node_parent1").siblings(".tree_node_child1");o.show(),o.find(".tree_node_child_checkbox").prop("checked",!0)}else $(this).parents(".tree_node_parent1").siblings(".tree_node_child1").hide(),t.parents(".tree_node_parent1").siblings(".tree_node_child1").find(".tree_node_child_checkbox").prop("checked",!1)}),$(".tree_node_child_checkbox").click(function(){var e=$(this),t=e.parents(".tree_node_child1").find(".tree_node_child_checkbox:checked").length;e.prop("checked")?1==t&&e.parents(".tree_node_child1").siblings(".tree_node_parent1").find(".tree_node_parent_checkbox").prop("checked",!0):0==t&&e.parents(".tree_node_child1").siblings(".tree_node_parent1").find(".tree_node_parent_checkbox").prop("checked",!1)})}),$(function(){$(".tree_node_parent_checkbox").click(function(){var e=$(this),t=($(this).prop("checked"),$(this).hasClass("check")),o=$(this).hasClass("weui-icon-success");$(this).removeClass("weui-icon-circle"),$(this).addClass("weui-icon-success"),console.log("ischeck1:"+o),console.log("ischeck:"+t);var n=$(this).siblings(".tree_node_child");t?(e.removeClass("check"),$(this).next().find(".tree_node_child_checkbox").removeClass("check")):(e.addClass("check"),$(this).next().find(".tree_node_child_checkbox").addClass("check"),n.show())}),$(".tree_node_child_checkbox").click(function(){var e=$(this).parent().find(".check").length,t=$(this),o=$(this).hasClass("check");console.log("ischildcheck:"+o),console.log("length:"+e),o?t.removeClass("check"):t.addClass("check"),(e=t.parent().find(".check").length)>=1?t.parent().prev().addClass("check"):t.parent().prev().removeClass("check")})})}})}}).init()})});